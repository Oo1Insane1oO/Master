\documentclass[book, hidelinks, 12pt]{memoir}
\linespread{1.25}
\usepackage[utf8]{inputenc}
% \usepackage[T1]{fontenc}
\usepackage{microtype}
\usepackage[style=numeric-comp, 
            backend=biber,
            url=false,
            doi=true,
            eprint=false]{biblatex}
% \usepackage[]{hyperref}
% \usepackage{courier}
% \usepackage{charter}
\usepackage[utopia]{mathdesign}
\usepackage{listings}
\usepackage[pdftex]{graphicx}
\usepackage[usenames,dvipsnames]{xcolor}
\usepackage{mathtools}
% \usepackage{amssymb}
\usepackage{amsmath}
\usepackage{braket}
\usepackage[margin=0.9in]{geometry}
\usepackage{subcaption}
\usepackage{float}
\usepackage{caption}
\usepackage{titlesec}
\usepackage{algpseudocode}
\usepackage{algorithm}
\usepackage{scrextend}
\usepackage{ragged2e}
\usepackage{multirow}
\usepackage{array}
\usepackage{physics}
\usepackage{enumitem}
\usepackage{varwidth}
\usepackage{etoolbox}
\usepackage{fancyhdr}
\usepackage{relsize}
\usepackage{soul}
\usepackage{tikz}
\usepackage{hyperref}

\usetikzlibrary{arrows.meta, shadows}

\overfullrule=2cm
\usepackage{calc,soul}
\makeatletter
\newlength\dlf@normtxtw
\setlength\dlf@normtxtw{\textwidth}
\def\myhelvetfont{\def\sfdefault{mdput}}
\newsavebox{\feline@chapter}
\newcommand\feline@chapter@marker[1][4cm]{%
\sbox\feline@chapter{%
\resizebox{!}{#1}{\fboxsep=1pt%
\colorbox{ForestGreen}{\color{white}\bfseries\sffamily\thechapter}%
}}%
\rotatebox{90}{%
\resizebox{%
\heightof{\usebox{\feline@chapter}}+\depthof{\usebox{\feline@chapter}}}%
{!}{\scshape\so\@chapapp}}\quad%
\raisebox{\depthof{\usebox{\feline@chapter}}}{\usebox{\feline@chapter}}%
}
\newcommand\feline@chm[1][4cm]{%
\sbox\feline@chapter{\feline@chapter@marker[#1]}%
\makebox[0pt][l]{% aka \rlap
\makebox[1cm][r]{\usebox\feline@chapter}%
}}
\makechapterstyle{daleif1}{
\renewcommand\chapnamefont{\normalfont\Large\scshape\raggedleft\so}
\renewcommand\chaptitlefont{\normalfont\huge\bfseries\scshape\color{ForestGreen}}
\renewcommand\chapternamenum{}
\renewcommand\printchaptername{}
\renewcommand\printchapternum{\null\hfill\feline@chm[2.5cm]\par}
\renewcommand\afterchapternum{\par\vskip\midchapskip}
\renewcommand\printchaptertitle[1]{\chaptitlefont\raggedleft ##1\par}
}
\makeatother

\chapterstyle{daleif1}

\lstset{mathescape}

\let\oldcite\cite
\renewcommand*\cite[1]{{\footnotesize\oldcite{#1}}}

% color courier
\definecolor{filecolor}{RGB}{180,43,190}
\definecolor{funccolor}{RGB}{150,83,210}
\newcommand{\hltexttt}[1]{\texttt{\color{filecolor}{#1}}}
\newcommand{\hltextttf}[1]{\texttt{\color{funccolor}{#1}}}

% biblatex input file 
\addbibresource{text/refs.bib}

%specific reused text
\newcommand{\mdate}{May 2018}
\newcommand{\mtitle}{Work in progress}
\newcommand{\mauthor}{Alfred Alocias Mariadason}
\newcommand{\massignn}{.}

\pagestyle{fancy}
\fancyhf{}
% \fancyhead[LO, RE]{\small\leftmark}
\lhead{\thesection}
\chead{}
\rhead{\small{\thechapter}}
% \lfoot{}
\cfoot{\thepage}
% \rfoot{}

%renew title numbering and number chapters, sections and subsections
\setcounter{secnumdepth}{2}
\setcounter{tocdepth}{2}
\renewcommand{\thechapter}{\arabic{chapter}}
\renewcommand{\thesection}{\thechapter.\arabic{section}}
\renewcommand{\thesubsection}{\thesection.\arabic{section}}
\renewcommand{\thesubsubsection}{\thesubsection.\arabic{section}}

%title settings
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\chapterautorefname}{chapter}
\renewcommand{\sectionautorefname}{section}
\renewcommand{\subsectionautorefname}{section}
\renewcommand{\subsubsectionautorefname}{section}
\renewcommand{\equationautorefname}{equation}
\renewcommand{\figureautorefname}{figure}
\renewcommand{\tableautorefname}{table}

\captionsetup{compatibility=false}

\patchcmd{\smallmatrix}{\thickspace}{\kern1.3em}{}{}
\patchcmd{\thebibliography}{\section*}{\section}{}{}

\newcommand{\algorithmautorefname}{algorithm}

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.3,0.3,0.3}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{codebackground}{rgb}{0.95,0.95,0.92}
\lstdefinestyle{pythonstyle}{
        backgroundcolor=\color{codebackground},
        commentstyle=\color{codegreen},
        keywordstyle=\color{magenta},
        numberstyle=\tiny\color{codegray},
        stringstyle=\color{codepurple},
        basicstyle=\footnotesize,
        breakatwhitespace=false,
        breaklines=true,
        captionpos=b,
        keepspaces=true,
        numbers=left, 
        numbersep=4pt, 
        showspaces=false, 
        showstringspaces=false,
        showtabs=true, 
        tabsize=2
}

\lstdefinestyle{ccstyle}{
    basicstyle=\footnotesize, % fontsize
    tabsize=4, % tab space width
    showstringspaces=false, % don't mark spaces in strings
    backgroundcolor=\color{codebackground},
    emph={HartreeFockSolver, string, DoubleWell, ImportanceSampling,
    BruteForce, HarmonicOscillator, SlaterJastrow, Jastrow, Integral, Slater,
    Wavefunction, Sampler, T, Minimizer},
    emphstyle={\color{magenta}},
    commentstyle=\color{green}, % comment color
    keywordstyle=\color{blue}, % keyword color
    stringstyle=\color{red} % string color
}

\lstdefinestyle{yamlstyle}{
    basicstyle=\footnotesize, % fontsize
    numberstyle=\footnotesize,
    tabsize=4, % tab space width
    showstringspaces=false, % don't mark spaces in strings
    backgroundcolor=\color{codebackground},
    emphstyle={\color{magenta}},
    emph={omega, numParticles, dim, maxitermc. stepmc, progress, parameters,
    numparameters, jastrow, importance, minimization, resampling}
    commentstyle=\color{green}, % comment color
    keywordstyle=\color{blue}, % keyword color
    stringstyle=\color{red} % string color
}

\hypersetup{
    colorlinks=true,
    linkcolor=black,
    filecolor=magenta,
    urlcolor=blue,
    citecolor=black
}
\urlstyle{same}

\newcommand\YAMLcolonstyle{\color{red}\footnotesize\mdseries}
\newcommand\YAMLkeystyle{\color{black}\footnotesize\bfseries}
\newcommand\YAMLvaluestyle{\color{blue}\footnotesize\mdseries}

\makeatletter

% here is a macro expanding to the name of the language
% (handy if you decide to change it further down the road)
\newcommand\language@yaml{yaml}

\expandafter\expandafter\expandafter\lstdefinelanguage
\expandafter{\language@yaml}
{
    showstringspaces=false, % don't mark spaces in strings
    backgroundcolor=\color{codebackground},
    keywords={true,false,null,y,n},
    keywordstyle=\color{darkgray},
    basicstyle=\YAMLkeystyle,                                 % assuming a key comes first
    sensitive=false,
    comment=[l]{\#},
    morecomment=[s]{/*}{*/},
    commentstyle=\color{purple}\ttfamily,
    stringstyle=\YAMLvaluestyle\ttfamily,
    moredelim=[l][\color{orange}]{\&},
    moredelim=[l][\color{magenta}]{*},
    moredelim=**[il][\YAMLcolonstyle{:}\YAMLvaluestyle]{:},   % switch to value style at :
    morestring=[b]',
    morestring=[b]",
    literate =      {---}{{\ProcessThreeDashes}}3
                    {>}{{\textcolor{red}\textgreater}}1     
                    {|}{{\textcolor{red}\textbar}}1 
                    {\ -\ }{{\mdseries\ -\ }}3,
}

% switch to key style at EOL
\lst@AddToHook{EveryLine}{\ifx\lst@language\language@yaml\YAMLkeystyle\fi}
\makeatother

\newcommand\ProcessThreeDashes{\llap{\color{cyan}\mdseries-{-}-}}


\newcommand{\onefigure}[4]{
    \begin{figure}[H]
        \centering
        \textbf{{#1}}\\
        \includegraphics[scale=0.96]{{#2}}
        \caption{{#3}}
        \label{fig:#4}
    \end{figure}
    \justifying
} %one figure {filename}{caption}
\newcommand{\twofigure}[7]{
    \begin{figure}[H]
        \centering
        \begin{subfigure}[b!]{0.49\textwidth}
            \centering
            \includegraphics[width=\textwidth]{{#1}}
            \caption{{#2}}
            \label{subfig:#3}
        \end{subfigure}
        \begin{subfigure}[b!]{0.49\textwidth}
            \centering
            \includegraphics[width=\textwidth]{{#4}}
            \caption{{#5}}
            \label{subfig:#6}
        \end{subfigure}
        \caption{#7}
        \justify
    \end{figure}
} %two figure one-line {title}{file1}{caption1}{file2}{caption2}

\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}

\makeatletter
% define a macro \Autoref to allow multiple references to be passed to \autoref
\newcommand\Autoref[1]{{\small\@first@ref#1,@}}
\def\@throw@dot#1.#2@{#1}% discard everything after the dot
\def\@set@refname#1{%    % set \@refname to autoefname+s using \getrefbykeydefault
    \edef\@tmp{\getrefbykeydefault{#1}{anchor}{}}%
    \def\@refname{\@nameuse{\expandafter\@throw@dot\@tmp.@autorefname}s}%
}
\def\@first@ref#1,#2{%
  \ifx#2@\autoref{#1}\let\@nextref\@gobble% only one ref, revert to normal \autoref
  \else%
    \@set@refname{#1}%  set \@refname to autoref name
    \@refname~\ref{#1}% add autoefname and first reference
    \let\@nextref\@next@ref% push processing to \@next@ref
  \fi%
  \@nextref#2%
}
\def\@next@ref#1,#2{%
   \ifx#2@ and~\ref{#1}\let\@nextref\@gobble% at end: print and+\ref and stop
   \else, \ref{#1}% print  ,+\ref and continue
   \fi%
   \@nextref#2%
}
\makeatother

\input{text/defs.tex}
